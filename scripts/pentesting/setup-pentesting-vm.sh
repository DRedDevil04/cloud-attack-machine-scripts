#!/bin/bash

# Pentesting VM Setup Script
# This script sets up a Linux VM for penetration testing activities

set -e

echo "=========================================="
echo "Setting up Pentesting VM"
echo "=========================================="

# Update system packages
echo "[+] Updating system packages..."
sudo apt update && sudo apt upgrade -y

# Install essential tools
echo "[+] Installing essential pentesting tools..."
sudo apt install -y \
    nmap \
    masscan \
    gobuster \
    dirb \
    nikto \
    sqlmap \
    hydra \
    john \
    hashcat \
    wireshark \
    tcpdump \
    netcat \
    socat \
    curl \
    wget \
    git \
    vim \
    tmux \
    screen \
    python3 \
    python3-pip \
    build-essential \
    gcc \
    make \
    unzip \
    zip \
    7zip

# Install Python tools
echo "[+] Installing Python-based tools..."
pip3 install --user \
    requests \
    beautifulsoup4 \
    scapy \
    impacket \
    pwntools \
    paramiko

# Create directories for tools
echo "[+] Creating directories..."
mkdir -p ~/tools
mkdir -p ~/wordlists
cd ~/tools

# Install Metasploit Framework
echo "[+] Installing Metasploit Framework..."
curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
chmod 755 msfinstall
sudo ./msfinstall

# Download common wordlists
echo "[+] Downloading wordlists..."
cd ~/wordlists
wget -O rockyou.txt.gz https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt
gunzip rockyou.txt.gz

# Install additional tools from GitHub
echo "[+] Installing additional tools..."
cd ~/tools

# LinPEAS
git clone https://github.com/carlospolop/PEASS-ng.git

# SecLists
git clone https://github.com/danielmiessler/SecLists.git

# Exploit-DB
git clone https://github.com/offensive-security/exploitdb.git

# Set up environment
echo "[+] Setting up environment..."
echo 'export PATH=$PATH:~/tools' >> ~/.bashrc
echo 'alias ll="ls -la"' >> ~/.bashrc
echo 'alias ..="cd .."' >> ~/.bashrc
echo 'alias nse="ls /usr/share/nmap/scripts/ | grep"' >> ~/.bashrc

# Configure firewall
echo "[+] Configuring firewall..."
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing

echo "=========================================="
echo "Pentesting VM setup completed!"
echo "=========================================="
echo ""
echo "Installed tools:"
echo "- Network scanning: nmap, masscan"
echo "- Web testing: gobuster, dirb, nikto, sqlmap"
echo "- Password attacks: hydra, john, hashcat"
echo "- Network analysis: wireshark, tcpdump"
echo "- Frameworks: Metasploit"
echo "- Additional: LinPEAS, SecLists, ExploitDB"
echo ""
echo "Please reboot the system to complete the setup."